<div class="chat-widget" [class.collapsed]="isCollapsed">
  <!-- Header del Chat -->
  <div class="chat-header" (click)="toggleChat()">
    <div class="header-content">
      <h3>ğŸ’¬ QA Assistant</h3>
      <div class="status-indicator">
        <span class="status-dot" [class.connected]="backendStatus === 'connected'" 
              [class.error]="backendStatus === 'error'"></span>
        <span>{{ backendStatus === 'connected' ? 'Conectado' : 
                backendStatus === 'error' ? 'Error' : 'Conectando...' }}</span>
      </div>
    </div>
    <button class="toggle-btn" (click)="toggleChat(); $event.stopPropagation()">
      {{ isCollapsed ? 'â†‘' : 'â†“' }}
    </button>
  </div>

  <!-- Contenido del Chat -->
  <div class="chat-content" *ngIf="!isCollapsed">
    
    <!-- Mensaje de Bienvenida con Preguntas RÃ¡pidas -->
    <div class="welcome-section" *ngIf="messages.length === 0">
      <div class="welcome-message">
        <h4>Â¡Bienvenido al QA Assistant! ğŸ‘‹</h4>
        <p>Selecciona una pregunta rÃ¡pida o escribe la tuya:</p>
      </div>
      <div class="quick-questions">
        <button *ngFor="let question of quickQuestions" 
                class="quick-btn" 
                (click)="quickQuestion(question)">
          {{ question }}
        </button>
      </div>
    </div>

    <!-- Contenedor de Mensajes -->
    <div class="messages-container">
      <div *ngFor="let msg of messages; trackBy: trackByFn" 
           class="message" 
           [class.user-message]="msg.type === 'user'"
           [class.assistant-message]="msg.type === 'assistant'">
        
        <!-- Avatar y Contenido -->
        <div class="message-avatar">
          {{ msg.type === 'user' ? 'ğŸ‘¤' : 'ğŸ¤–' }}
        </div>
        
        <div class="message-content">
          <!-- Texto del Mensaje -->
          <div class="message-text" [innerHTML]="formatMessage(msg.text)"></div>
          
          <!-- Timestamp -->
          <div class="message-time">{{ msg.timestamp | date:'HH:mm' }}</div>
          
          <!-- Sugerencias -->
          <div class="suggestions" *ngIf="msg.suggestions && msg.suggestions.length > 0">
            <div class="suggestions-label">Â¿Te interesa?</div>
            <button *ngFor="let suggestion of msg.suggestions" 
                    class="suggestion-btn"
                    (click)="useSuggestion(suggestion)">
              {{ suggestion }}
            </button>
          </div>
          
          <!-- Fuentes -->
          <div class="sources" *ngIf="msg.sources && msg.sources.length > 0">
            <div class="sources-label">Fuentes:</div>
            <div *ngFor="let source of msg.sources" class="source-item">
              <span class="source-icon">ğŸ“š</span>
              <span class="source-text">
                {{ source.title || getFileName(source.url || '') }}
              </span>
              <a *ngIf="source.url" [href]="source.url" target="_blank" class="source-link">
                ğŸ”—
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Indicador de Carga -->
      <div class="loading-indicator" *ngIf="loading">
        <div class="typing-animation">
          <span></span>
          <span></span>
          <span></span>
        </div>
        <span>Procesando pregunta...</span>
      </div>
    </div>

    <!-- Input y Controles -->
    <div class="input-section">
      <div class="input-container">
        <input type="text" 
               [(ngModel)]="userInput" 
               (keyup.enter)="sendMessage()"
               placeholder="Escribe tu pregunta sobre QA..."
               [disabled]="loading">
        <button class="send-btn" 
                (click)="sendMessage()" 
                [disabled]="loading || !userInput.trim()">
          <span *ngIf="!loading">â¤</span>
          <div class="spinner" *ngIf="loading"></div>
        </button>
      </div>
      
      <!-- Botones de AcciÃ³n -->
      <div class="action-buttons">
        <button class="action-btn" (click)="clearChat()" title="Limpiar chat">
          ğŸ—‘ï¸ Limpiar
        </button>
        <button class="action-btn" (click)="toggleChat()" title="Minimizar">
          ğŸ“Œ Minimizar
        </button>
      </div>
    </div>
  </div>
</div>